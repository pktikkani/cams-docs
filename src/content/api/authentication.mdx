# Authentication API

## Contractor Login

```
POST /api/v1/auth/login
```

### Request Body

```json
{
  "email": "john.doe@contractor.com",
  "password": "password123",
  "device_fingerprint": "a1b2c3d4e5f6"
}
```

### Success Response (200)

```json
{
  "status": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "contractor": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "full_name": "John Doe",
      "email": "john.doe@contractor.com",
      "company": "Acme Corp",
      "totp_seed": "JBSWY3DPEHPK3PXP",
      "photo_url": "https://...",
      "is_active": true
    }
  }
}
```

### Error Response (401)

```json
{
  "status": "error",
  "message": "Invalid credentials"
}
```

## Guard Login

```
POST /api/v1/scanner/login
```

### Request Body

```json
{
  "email": "guard@security.com",
  "password": "guardpass123",
  "device_fingerprint": "x9y8z7w6v5u4"
}
```

### Success Response (200)

```json
{
  "status": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "guard": {
      "id": "uuid",
      "name": "Security Guard",
      "assigned_site": {
        "id": "uuid",
        "site_code": "NAMA-HQ-001",
        "site_name": "NAMA Headquarters"
      }
    }
  }
}
```

## Admin Login

```
POST /api/v1/admin/login
```

### Request Body

```json
{
  "email": "admin@cams.com",
  "password": "password123"
}
```

### Success Response (200)

```json
{
  "status": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "user": {
      "id": "uuid",
      "email": "admin@cams.com",
      "name": "Super Admin",
      "role": "super_admin"
    }
  }
}
```

See [Admin Endpoints](/docs/api/admin) for the full admin API.

## HMAC Request Signing

Contractor and scanner endpoints require HMAC-SHA256 request signing in addition to JWT. Two headers must be present:

| Header | Description |
|--------|-------------|
| `X-Timestamp` | Unix timestamp (seconds). Must be within 90 seconds of server time. |
| `X-Signature` | HMAC-SHA256 of `timestamp.body` using the shared secret. |

Requests missing or failing HMAC verification return `401 Unauthorized`.

Admin endpoints do **not** require HMAC â€” only JWT authentication.
